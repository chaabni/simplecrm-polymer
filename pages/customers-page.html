<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/vaadin-components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="/elements/customer-data.html">
<link rel="import" href="/elements/customer-form.html">

<dom-module id="customers-page">
    <template>
        <customer-data customers="{{customers}}"></customer-data>
        <h2>Customers</h2>

        <customer-form id="customerForm"></customer-form>
        <hr />
        <v-grid id="customersGrid">
            <table>
                <colgroup>
                    <col name="firstName" header-text="First name" sortable="true">
                    <col name="lastName" header-text="Last name" sortable="true">
                    <col name="email" header-text="Email" sortable="true">
                    <col name="status" header-text="Status" sortable="true">
                </colgroup>
            </table>
        </v-grid>
    </template>
    <script>
        Polymer({
            is: 'customers-page',

            properties: {
                customers: {
                    type: Array,
                    observer: '_customersChanged'
                },
                selectedCustomer: {
                    type: Object
                }
            },

            ready: function() {
                this.$.customersGrid.addEventListener('sort', function() {
                    var grid = this.$.customersGrid;
                    var column = grid.data.sortOrder[0].column;
                    var property = grid.columns[column].name;
                    var asc = grid.data.sortOrder[0].direction === 'asc';
                    this._sortCustomers(property, asc);
                }.bind(this));

                this.$.customersGrid.addEventListener('select', function() {
                    var selected = this.$.customersGrid.selection.selected();
                    if (selected.length > 0) {
                        var selectedCustomer = this.$.customersGrid.data.source[selected[0]];
                        this.$.customerForm.selectedCustomer = selectedCustomer;
                    }
                }.bind(this));
            },

            _customersChanged: function() {
                this.async(function() {
                    this.$.customersGrid.data.source = this.customers;
                });
            },

            _sortCustomers: function(sortProperty, ascending) {
                this.customers.sort(function(item1, item2) {
                    if (item1[sortProperty] < item2[sortProperty]) {
                        return (ascending ? -1 : 1);
                    } else {
                        return (ascending ? 1 : -1);
                    }
                });
            },

        });
    </script>
</dom-module>
