<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/vaadin-charts/v-chart.html">
<link rel="import" href="/elements/customer-data.html">

<dom-module id="analyze-page">
    <link rel="import" type="css" href="page-styles.css">
    <template>
        <customer-data id="customerData" customers="{{customers}}"></customer-data>

        <div class="header">
            <h2>Customer analysis</h2>
        </div>

        <div class="content">
            <v-chart id="ageChart" vc-type="column">
                <vc-title>Age</vc-title>
                <v-series name="Age">
                    <vc-data id="ageData">10, 20, 30, 40</vc-data>
                </v-series>
            </v-chart>

            <v-chart id="genderChart" vc-type="pie">
                <vc-title>Gender</vc-title>
                <vc-tooltip vc-point-format="{point.percentage:.1f}%"></vc-tooltip>
                <vc-plot-options>
                    <vc-pie vc-allow-point-select="true" vc-cursor="pointer">
                        <vc-data-labels vc-enabled="true" vc-format="<b>{point.name}</b>: {point.percentage:.1f}%"></vc-data-labels>
                    </vc-pie>
                </vc-plot-options>

                <v-series id="genderSeries" vc-name="Gender">
                    <vc-data id="genderSeriesData">
                        ["Men",   40.0],
                        ["Women", 60.0]
                    </vc-data>
                </v-series>
            </v-chart>
        </div>
    </template>
    <script>
        Polymer({
            is: 'analyze-page',

            properties: {
                customers: {
                    type: Array,
                    observer: '_customersChanged'
                }
            },

            _customersChanged: function() {
                var yearMs = 1000 * 60 * 60 * 24 * 365;
                var ages = this.customers.map(function(customer) {
                    var ageMs = new Date().getTime() - new Date(customer.birthDate).getTime();
                    return Math.floor(ageMs / yearMs);
                });
                // TODO Add to chart or use data-binding.
                console.log(ages);
            }
        });
    </script>
</dom-module>
